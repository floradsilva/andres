"use strict";(function(){jQuery(document).ready(function(h){var s,o,a,e,t,n,c,p,i,l,r,u,d,g;return g=null!=(r=window.wc_local_pickup_plus_frontend)?r:{},i=function(e){return!!e&&(e.is(".processing")||e.parents(".processing").length)},s=function(e){if(e&&!i(e))return e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},d=function(e){if(e)return e.removeClass("processing").unblock()},t=function(){var i,n,c,e;return e=h("#wc-local-pickup-plus-toggle-default-handling").find("a.toggle-default-handling"),i=h("form.woocommerce-cart-form"),n=h("div.cart_totals"),c=h("#order_review"),e.on("click",function(e){var t,a;return e.preventDefault(),s(i),s(n),s(c),t=h(this).hasClass("pickup")?"pickup":"ship",a={action:"wc_local_pickup_plus_set_default_handling",security:g.set_default_handling_nonce,handling:t},h.post(g.ajax_url,a,function(e){if(e.success)if(g.is_checkout){if(l()&&o(),h(document.body).trigger("update_checkout"),g.apply_pickup_location_tax)return location.reload()}else h(document).trigger("wc_update_cart");else console.log(e);return d(i),d(n),d(c)})})},l=function(){var e,t,a,i;return i=h("#shipping_state").val(),a=h("input#shipping_postcode").val(),t=h("#shipping_city").val(),e=h("input#shipping_address_1").val(),""===i&&""===a&&""===t&&""===e},o=function(){return h("#shipping_state").val(h("#billing_state").val()),h("input#shipping_postcode").val(h("input#billing_postcode").val()),h("#shipping_city").val(h("#billing_city").val()),h("input#shipping_address_1").val(h("input#billing_address_1").val())},a=function(e){var t,a;return e.id?(a=t="",e.name&&e.address?(a=e.name,t=e.address):h(e.element)&&(a=h(e.element).data("name"),t=h(e.element).data("address")),""!==a?h('<div id="wc-local-pickup-plus-pickup-location-option-'+e.id+'" class="wc-local-pickup-plus-pickup-location-option"><span class="wc-location-pickup-plus-pickup-location-option-name" style="display:block;">'+a+'</span><small class="wc-location-pickup-plus-pickup-location-option-address" style="display:inline-block;">'+t+"</small></div>"):e.text):e.text?e.text:""},n=function(){var e;return h("a.enable-local-pickup, a.disable-local-pickup").on("click",function(e){var t,a,i,n,c,o,p,l,r,u;return e.preventDefault(),i=h(this).parent().parent(),t=h("form.woocommerce-cart-form"),a=h("#order_review"),h(this).hasClass("enable-local-pickup")?(l="pickup",i.find("a.enable-local-pickup").parent().hide(),i.find("a.disable-local-pickup").parent().show(),i.find("> div").show()):(l="ship",i.find("a.enable-local-pickup").parent().show(),i.find("a.disable-local-pickup").parent().hide(),i.find("> div").hide()),s(t),s(a),n=i.find(".pickup-location-lookup-area"),(r=(u=(o=i.find(".pickup-location-lookup")).attr("data-single-pickup-location"))&&0<parseInt(u,10)?u:o.val())||"per-order"!==g.pickup_selection_mode||(r=(c=h('[name="shipping_method_pickup_location_id[0]"]')).length?c.val():r),p={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:i.data("pickup-object-id"),pickup_data:{handling:l,lookup_area:n.val(),pickup_location_id:r}},h.post(g.ajax_url,p,function(e){return"per-order"===g.pickup_selection_mode&&h(".pickup-location-lookup").trigger("change"),d(t),d(a),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})}),h(".pickup-location-change-lookup-area").on("click",function(e){return e.preventDefault(),h(this).closest("div.pickup-location-lookup-area-field").find("> div").toggle()}),(e=h("select.pickup-location-lookup-area")).select2(),e.on("change",function(){var t,a,e,i,n,c,o,p,l,r,u;if(o=h(this).closest(".pickup-location-lookup-area-field").data("pickup-object-id"),!h("#pickup-location-field-for-"+o).find("a.enable-local-pickup").is(":visible")&&(i=h("#pickup-location-lookup-area-field-for-"+o).find("em.pickup-location-current-lookup-area-label"),p=h(this).select2("data"),t=h("form.woocommerce-cart-form"),a=h("#order_review"),p&&p[0]&&p[0].text&&i.text(p[0].text),s(t),s(a),r=(n=h("#pickup-location-field-for-"+o).find(".pickup-location-lookup")).data("pickup-object-type"),l=(u=n.attr("data-single-pickup-location"))&&0<parseInt(u,10)?u:n.val(),"cart-item"===r?c={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:o,pickup_data:{handling:"pickup",lookup_area:h(this).val(),pickup_location_id:l}}:"package"===r&&(e=h("#wc-local-pickup-plus-datepicker-"+o),c={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,package_id:o,lookup_area:h(this).val(),pickup_location_id:l},e.length&&e.val()&&(c.pickup_date=e.val())),c))return h.post(g.ajax_url,c,function(e){return d(t),d(a),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})})},c=function(){var n,t;return t=function(e,t,a){var i,n,c,o;return e=e?e.toLowerCase():"",t=t?t.toLowerCase():"",c=!1,e&&(t&&-1<t.indexOf(e)&&(c=!0),!c&&a&&(o=String(h(a.element).data("postcode")),n=h(a.element).data("city"),i=h(a.element).data("address"),o&&-1<o.toString().toLowerCase().indexOf(e)&&(c=!0),!c&&n&&-1<n.toString().toLowerCase().indexOf(e)&&(c=!0),!c&&i&&-1<i.toString().toLowerCase().indexOf(e)&&(c=!0))),c},n=h("select.pickup-location-lookup"),g.use_enhanced_search?n.select2({initSelection:function(e,t){var a,i;return""!==(i=e.val())?(a={action:"wc_local_pickup_plus_get_pickup_location_name",security:g.get_pickup_location_name_nonce,id:i},h.post(g.ajax_url,a,function(e){if(e&&e.success&&e.data)return t({id:i,text:e.data})})):t({text:n.data("placeholder")})},minimumInputLength:2,language:{inputTooShort:function(){return g.i18n.search_type_minimum_characters},errorLoading:function(){return g.i18n.search_error_loading},loadingMore:function(){return g.i18n.search_loading_more},noResults:function(){return g.i18n.search_no_results},searching:function(){return g.i18n.search_searching}},templateResult:a,ajax:{url:g.ajax_url,cache:!1,dataType:"json",delay:250,data:function(e){var t,a,i;return i=h(this).data("product-id"),a=h(this).data("pickup-object-id"),t=h(this).parent().find("#pickup-location-lookup-area-for-"+a),{term:e.term,area:t?t.find("option:selected").val():"",cart_item_id:a,product_id:i,page:e.page,security:g.pickup_locations_lookup_nonce,action:"wc_local_pickup_plus_pickup_locations_lookup"}},processResults:function(e,t){return{results:e&&e.success&&e.data?e.data:[]}}}}):h.fn.select2.amd.require(["select2/compat/matcher"],function(e){return n.select2({templateResult:a,matcher:e(t)})}),n.on("change",function(e){var t,a,i,n,c,o,p;if(t=h("form.woocommerce-cart-form, div.cart_totals"),a=h("#order_review"),s(t),s(a),o=h(this).data("pickup-object-type"),p=h(this).data("pickup-object-id"),n=h(this).val(),c=h("#pickup-location-lookup-area-for-"+p).val(),"cart-item"===o?i={action:"wc_local_pickup_plus_set_cart_item_handling",security:g.set_cart_item_handling_nonce,cart_item_key:p,pickup_data:{handling:"pickup",lookup_area:c,pickup_location_id:n}}:"package"===o&&(i={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,package_id:p,lookup_area:c,pickup_location_id:n}),i)return h.post(g.ajax_url,i,function(e){return d(t),d(a),e.success?g.is_cart?h(document).trigger("wc_update_cart"):g.is_checkout?h(document.body).trigger("update_checkout"):void 0:console.log(e)})})},u=function(){var e;if(!g.display_shipping_address_fields)return(e=parseInt(h("#wc-local-pickup-plus-packages-to-ship").val(),10))<parseInt(h("#wc-local-pickup-plus-packages-to-pickup").val(),10)&&0===e?(h("#shiptobilling, #ship-to-different-address").hide(),h("#shiptobilling, #ship-to-different-address").parent().find("h3").hide(),h("#ship-to-different-address input").removeAttr("checked"),h(".shipping_address").hide()):(h("#shiptobilling, #ship-to-different-address").show(),h("#shiptobilling, #ship-to-different-address").parent().find("h3").show(),"shipping"===g.ship_to_destination?(h("#ship-to-different-address input").attr("checked",!0),h(".shipping_address").show()):void 0)},e=function(){return h(".woocommerce-shipping-totals").each(function(){if("local_pickup_plus"===h(this).find("input.shipping_method").val())return h(this).find("p.woocommerce-shipping-destination").empty()})},(p=function(){return h(".wc-lpp-help-tip").each(function(){return h(this).tipTip({content:h(this).data("tip"),keepAlive:!0,edgeOffset:2})})})(),t(),n(),c(),"undefined"!=typeof wc_cart_params&&e(),"undefined"!=typeof wc_checkout_params&&u(),h(document.body).on("updated_checkout",function(){var e,f,i;return i=function(a,e,t){var i,n,c,o,p,l,r,u,s,d,_,k=2<arguments.length&&void 0!==t&&t;return n=a.find("input.pickup-location-appointment-date"),i=a.find("input.pickup-location-appointment-date-alt"),c=a.find("[id^=wc-local-pickup-plus-date-clear-]"),p=n.val(),r=n.data("location-id"),u=n.data("package-id"),l=""!==p?new Date(p):e.default_date&&""!==e.default_date?new Date(e.default_date):null,_=e.unavailable_dates?h.map(e.unavailable_dates,function(e){return e}):[],k&&(n.attr("value",""),n.trigger("change"),n.removeClass("hasDatepicker"),n.datepicker("destroy")),n.datepicker({minDate:new Date(e.calendar_start),maxDate:new Date(e.calendar_end),altField:"#"+i.attr("id"),altFormat:"yy-mm-dd",dateFormat:g.date_format,defaultDate:l||null,firstDay:g.start_of_week,monthNames:g.month_names,dayNamesMin:g.day_initials,prevText:"",nextText:"",beforeShow:function(e,t){return h(t.dpDiv).addClass("pickup-location-appointment-datepicker")},beforeShowDay:function(e){var t;return t=h.datepicker.formatDate("yy-mm-dd",e),[-1===_.indexOf(t)]},onSelect:f}),(s=(o=n.val())&&""!==o?h.datepicker.parseDate("yy-mm-dd",o):null)?(n.datepicker("setDate",s),h("#ui-datepicker-div").hide()):e.auto_select_default&&e.default_date&&""!==e.default_date&&(d=h.datepicker.parseDate("yy-mm-dd",e.default_date))&&(n.datepicker("setDate",d),h("#ui-datepicker-div").hide(),f(d,n)),c.on("click",function(e){var t;return e.preventDefault(),n.datepicker("setDate",null),n.attr("value",""),t={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,pickup_date:"",package_id:u,pickup_location_id:r},h.post(g.ajax_url,t,function(e){return e.success||console.log(e),a.find(".pickup-location-schedule").empty(),h(document.body).trigger("update_checkout")})})},f=function(e,t){var a,i,n,c,o,p,l;if(a=t.input||t,i=a.parent().parent(),o=a.data("location-id"),p=a.data("package-id"),n=h("#wc-local-pickup-plus-pickup-date-"+p),l=n.val(),e&&l&&new Date(l))return a.attr("value",e),c={action:"wc_local_pickup_plus_set_package_handling",security:g.set_package_handling_nonce,pickup_date:l,package_id:p,pickup_location_id:o},h.post(g.ajax_url,c,function(e){return e.success||console.log(e),c={action:"wc_local_pickup_plus_get_pickup_location_opening_hours_list",security:g.get_pickup_location_opening_hours_list_nonce,location:o,date:l},h.post(g.ajax_url,c,function(e){var t;if((t=i.find(".pickup-location-schedule")).empty(),e&&e.success)return t.append(e.data),h(document.body).trigger("update_checkout")})})},(e=h(".pickup-location-appointment"))&&e.each(function(){var t,e,a;return e=(t=h(this)).find("input.pickup-location-appointment-date").data("location-id"),a={action:"wc_local_pickup_plus_get_pickup_location_appointment_data",security:g.get_pickup_location_appointment_data_nonce,location:e},h.post(g.ajax_url,a,function(e){if(e.success)return i(t,e.data)})}),p(),t(),n(),c(),u(),h("#order_review").find("> p.woocommerce-shipping-contents").remove()}),h("#order_review").find("> p.woocommerce-shipping-contents").remove(),h(document.body).on("updated_cart_totals",function(){return p(),t(),n(),c(),e()})})}).call(void 0);